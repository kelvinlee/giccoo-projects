function iniListenSound(){document.addEventListener("WeixinJSBridgeReady",function(){bgm.play()},!1)}function initAll(){renderer.setClearColor(6798302),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.type=THREE.BasicShadowMap,renderer.setPixelRatio(2),renderer.shadowMapEnabled=!0,renderer.gammaInput=!0,renderer.gammaOutput=!0,console.log("==========toneMapping",renderer.toneMapping),document.body.appendChild(renderer.domElement),loadingMods("mod/car.gltf",["car"]),loadingMods("mod/car_wheel.gltf",["car_wheel"]),loadingMods("mod/waterfall.gltf",["waterfall"]),loadingMods("mod/fire.gltf",["fire"]),loadingMods("mod/island.gltf",["island"]),loadingMods("mod/trees1.gltf",["trees1"],"addScene"),clickFunc()}function animate(){requestAnimationFrame(animate),render()}function render(){renderer.render(scene,camera)}function setTest(){controls=new THREE.OrbitControls(camera,renderer.domElement),guiControls=new function(){this.X=0,this.Y=150,this.Z=0,this.ifTrue=!0,this.func=function(){console.log("一个函数")},this.target=rootPointBody}}function clickFunc(){document.addEventListener("touchstart",onDocumentTouchStart,!1),document.addEventListener("touchmove",onDocumentTouchMove,!1),document.addEventListener("touchend",onDocumentTouchEnd,!1)}function onDocumentTouchStart(e){mouse.x=e.touches[0].clientX/window.innerWidth*2-1,mouse.y=-e.touches[0].clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera),intersects=[],raycaster.intersectObjects(meshes,!1,intersects),intersects.length>0&&console.log(intersects)}function onDocumentTouchMove(e){}function onDocumentTouchEnd(e){controls.enabled=!0}function loadingMods(e,o,n){var t;modNum++,(new THREE.GLTFLoader).load(e,function(e){modLoadedNum++,console.log(e.scene);for(var t=0;t<e.scene.children.length;t++)objs[o[t]]=e.scene.children[t],n&&scene.add(objs[o[t]]),console.log(o[t]);loadingCheck()},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.log("An error happened",e)})}function loadingCheck(){modNum==modLoadedNum?(console.log("模型加载完成",modLoadedNum,"/",modNum),setTest(),ModLoaded()):console.log("模型加载中",modLoadedNum,"/",modNum)}function ModLoaded(){getStart()}function getStart(){console.log("getStart!"),camera.position.set(400,100,400),camera.lookAt(scene.position),setFire(),setSun(),setCar(),setCloud(),objs.island.position.y=0,objs.island.scale.set(1.1,1.1,1.1),scene.add(objs.island);for(var e=0;e<objs.island.children.length;e++)objs.island.children[e].castShadow=!0,objs.island.children[e].receiveShadow=!0;objs.island.children[0].receiveShadow=!1,objs.island.children[0].material.side=THREE.DoubleSide,console.log(objs.island),objs.trees1.position.y=0,objs.trees1.scale.set(1.1,1.1,1.1),scene.add(objs.trees1);for(var e=0;e<objs.trees1.children.length;e++)objs.trees1.children[e].castShadow=!0,objs.trees1.children[e].material.side=THREE.DoubleSide;objs.waterfall.position.y=1,objs.waterfall.scale.set(1.1,1.1,1.1);var o=objs.waterfall.geometry;waterfall=new THREE.Water(o,{color:params.color,scale:params.scale,flowDirection:new THREE.Vector2(params.flowX,params.flowY),textureWidth:128,textureHeight:128,reflectivity:.02}),waterfall.scale.set(1.1,1.1,1.1),scene.add(waterfall);var n=new THREE.PlaneBufferGeometry(1500,1500);water2=new THREE.Water(n,{color:params.color,scale:params.scale,flowDirection:new THREE.Vector2(params.flowX,params.flowY),textureWidth:512,textureHeight:512}),water2.position.y=1,water2.rotation.x=-.5*Math.PI,scene.add(water2),animate()}var scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e4),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1}),modNum=0,modLoadedNum=0,objs={},stats=null,world=new CANNON.World,rootPoint,rootPointBody,carShape,carBody;window.onload=function e(){loadWechatConfig(),initAll(),iniListenSound(),wx.ready(function(){var e;return e={title:"岛 - 薄荷犀牛",desc:"岛屿夏云起，汀洲芳草深。",link:"https://m.giccoo.com/findsheep/",imgUrl:"img/ico.jpg",success:function(){},cancel:function(){}},wx.onMenuShareTimeline(e),wx.onMenuShareAppMessage(e),wx.onMenuShareQQ(e),wx.onMenuShareWeibo(e)})};var loadWechatConfig=function(){var e,o,n;n=encodeURIComponent(window.location.href.split("#")[0]),(e=document.createElement("script")).src="//api.giccoo.com/api/config?url="+n,(o=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,o)},ifbgm=0,bgm=document.getElementById("bgm"),cannonDebugRenderer=new THREE.CannonDebugRenderer(scene,world),controls,guiControls,datGUI,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,intersects=[],mouseConstraint=void 0,meshes=[],bodies=[],params={color:"#67bbde",scale:.8,flowX:-1,flowY:-.5};