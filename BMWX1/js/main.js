// Generated by CoffeeScript 1.9.1
var ANIMATION_END_NAME, ANIMATION_END_NAMES, Store, TRANSITION_END_NAME, TRANSITION_END_NAMES, VENDORS, _history, begin, controllers, css3Prefix, i, j, layzr, len, mTestElement, routeFun, routeParser;

VENDORS = ["Moz", 'webkit', 'ms', 'O'];

TRANSITION_END_NAMES = {
  "Moz": "transitionend",
  "webkit": "webkitTransitionEnd",
  "ms": "MSTransitionEnd",
  "O": "oTransitionEnd"
};

ANIMATION_END_NAMES = {
  "Moz": "animationend",
  "webkit": "webkitAnimationEnd",
  "ms": "MSAnimationEnd",
  "O": "oAnimationEnd"
};

mTestElement = document.createElement("div");

for (j = 0, len = VENDORS.length; j < len; j++) {
  i = VENDORS[j];
  css3Prefix = i;
  if ((css3Prefix + "Transition") in mTestElement.style) {
    break;
  }
  css3Prefix = false;
}

if (css3Prefix) {
  TRANSITION_END_NAME = TRANSITION_END_NAMES[css3Prefix];
  ANIMATION_END_NAME = ANIMATION_END_NAMES[css3Prefix];
}

Array.prototype.clean = function(deleteValue) {
  i = 0;
  while (i < this.length) {
    if (this[i] === deleteValue) {
      this.splice(i, 1);
      i--;
    }
    i++;
  }
  return this;
};

HTMLElement.prototype.getStyle = function(className) {
  if (this.currentStyle) {
    return this.currentStyle(className);
  } else {
    return document.defaultView.getComputedStyle(this, false)[className];
  }
};

(function() {
  var lastTime, vendors, x;
  lastTime = 0;
  vendors = ["webkit", "moz"];
  x = 0;
  while (x > vendors.length && !window.requestAnimationFrame) {
    console.log("" + vendors[x]);
  }
  window.requestAnimationFrame = window[vendors[x] + "RequestAnimationFrame"];
  window.cancelAnimationFrame = window[vendors[x] + "CancelAnimationFrame"] || window[vendors[x] + "CancelRequestAnimationFrame"];
  ++x;
  if (!window.requestAnimationFrame) {
    window.requestAnimationFrame = function(callback, element) {
      var currTime, id, timeToCall;
      currTime = new Date().getTime();
      timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
      id = window.setTimeout(function() {
        callback(currTime + timeToCall);
      }, timeToCall);
      lastTime = currTime + timeToCall;
      return id;
    };
  }
  if (!window.cancelAnimationFrame) {
    window.cancelAnimationFrame = function(id) {
      clearTimeout(id);
    };
  }
})();

Store = {};

_history = [];

begin = false;

controllers = {
  before: function(next) {
    if (!begin) {
      riot.route("/");
    }
    return next();
  },
  homepage: function(action, id) {
    return Store.parallax && Store.parallax.animate("homepage");
  },
  activity: function(action, id) {
    return Store.parallax && Store.parallax.animate("activity");
  },
  register: function(action, id) {
    return Store.parallax && Store.parallax.animate("register");
  },
  food: function(action, id) {
    return Store.parallax && Store.parallax.animate("food");
  },
  bmwx1: function(action, id) {
    return Store.parallax && Store.parallax.animate("bmwx1");
  }
};

routeFun = function(collection, action, id) {
  var fn;
  if (collection == null) {
    collection = "homepage";
  }
  console.log("route:", collection, action, id);
  fn = controllers[collection];
  return controllers["before"](function() {
    fn && fn(action, id);
    return _history.push([collection, action, id]);
  });
};

routeParser = function(path) {
  var paths;
  paths = path.split("/");
  return paths.clean("");
};

riot.route.parser(routeParser);

riot.route(routeFun);

riot.route.exec(routeFun);

riot.mount("*");

layzr = null;

window.onload = function() {
  $("#loading").hide();
  return layzr = new Layzr({
    callback: function(e) {}
  });
};
